<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Memory Card Game</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      padding-top: 20px;
      color: #333;
    }

    #game-board {
      display: grid;
      grid-template-columns: repeat(4, 120px);
      grid-gap: 15px;
      justify-content: center;
      margin: 30px auto;
      perspective: 1000px;
    }

    .card {
      width: 120px;
      height: 160px;
      position: relative;
      cursor: pointer;
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }

    .card.flipped {
      transform: rotateY(180deg);
    }

    .card .front, .card .back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
    }

    .card .back {
      background: #4a4a4a;
    }

    .card .front {
      background: white;
      transform: rotateY(180deg);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .card.matched .front {
      border: 3px solid limegreen;
      animation: glow 1s infinite alternate;
    }

    .card.wrong {
      animation: shake 0.5s;
    }

    @keyframes glow {
      from { box-shadow: 0 0 10px limegreen; }
      to   { box-shadow: 0 0 25px limegreen; }
    }

    @keyframes shake {
      0% { transform: rotateY(180deg) translateX(0); }
      25% { transform: rotateY(180deg) translateX(-5px); }
      50% { transform: rotateY(180deg) translateX(5px); }
      75% { transform: rotateY(180deg) translateX(-5px); }
      100% { transform: rotateY(180deg) translateX(0); }
    }

    #hearts {
      font-size: 28px;
      margin: 10px;
      transition: transform 0.3s;
    }

    #hearts.gain {
      transform: scale(1.3);
      color: crimson;
    }

    #hearts.lose {
      animation: heart-bounce 0.5s;
    }

    @keyframes heart-bounce {
      0% { transform: scale(1); color: crimson; }
      50% { transform: scale(0.7); color: darkred; }
      100% { transform: scale(1); color: crimson; }
    }

    #message {
      font-size: 32px;
      font-weight: bold;
      margin-top: 10px;
      opacity: 0;
      transition: opacity 0.5s, transform 0.5s;
    }

    #message.show {
      opacity: 1;
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <h1>Memory Card Game</h1>
  <div id="hearts"></div>
  <div id="game-board"></div>
  <div id="message"></div>

  <script>
    const board = document.getElementById("game-board");
    const heartsDiv = document.getElementById("hearts");
    const messageDiv = document.getElementById("message");

    let stage = 1;
    let hearts = 0;
    let firstCard = null;
    let lockBoard = false;
    let cards = [];

    function startStage() {
      // ìŠ¤í…Œì´ì§€ë³„ í•˜íŠ¸ ì´ˆê¸°í™”
      if (stage === 1) hearts = 10;
      else if (stage === 2) hearts = 8;
      else hearts = 5;

      updateHearts();
      showMessage(`Stage ${stage}`);
      board.innerHTML = "";
      cards = generateCards();
      shuffle(cards);

      cards.forEach(img => {
        const card = document.createElement("div");
        card.classList.add("card");

        const front = document.createElement("div");
        front.classList.add("front");
        front.textContent = img;

        const back = document.createElement("div");
        back.classList.add("back");

        card.appendChild(front);
        card.appendChild(back);

        card.dataset.img = img;
        card.addEventListener("click", flipCard);
        board.appendChild(card);
      });
    }

    function updateHearts(change = 0) {
      heartsDiv.textContent = "â¤ï¸".repeat(hearts);

      if (change > 0) {
        heartsDiv.classList.add("gain");
        setTimeout(() => heartsDiv.classList.remove("gain"), 300);
      } else if (change < 0) {
        heartsDiv.classList.add("lose");
        setTimeout(() => heartsDiv.classList.remove("lose"), 500);
      }
    }

    function showMessage(text) {
      messageDiv.textContent = text;
      messageDiv.classList.add("show");
      setTimeout(() => {
        messageDiv.classList.remove("show");
      }, 1500);
    }

    function generateCards() {
      // ì¹´ë“œ ì´ë¯¸ì§€ (ì´ëª¨ì§€ í™œìš©)
      const base = ["ðŸŽ","ðŸŒ","ðŸ‡","ðŸ“","ðŸŠ","ðŸ‰","ðŸ","ðŸ¥"];
      const selected = base.slice(0, 8); 
      return [...selected, ...selected]; // ì§ ë§žì¶”ê¸°ìš©
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function flipCard() {
      if (lockBoard || this.classList.contains("flipped")) return;

      this.classList.add("flipped");

      if (!firstCard) {
        firstCard = this;
      } else {
        checkMatch(this);
      }
    }

    function checkMatch(secondCard) {
      if (firstCard.dataset.img === secondCard.dataset.img) {
        // ë§¤ì¹­ ì„±ê³µ
        firstCard.classList.add("matched");
        secondCard.classList.add("matched");
        hearts++;
        updateHearts(+1);
        firstCard = null;
      } else {
        // ë§¤ì¹­ ì‹¤íŒ¨
        lockBoard = true;
        hearts--;
        updateHearts(-1);

        firstCard.classList.add("wrong");
        secondCard.classList.add("wrong");

        setTimeout(() => {
          firstCard.classList.remove("flipped","wrong");
          secondCard.classList.remove("flipped","wrong");
          firstCard = null;
          lockBoard = false;
        }, 1000);

        if (hearts <= 0) {
          showMessage("Game Over!");
          setTimeout(() => {
            stage = 1;
            startStage();
          }, 2000);
          return;
        }
      }

      // ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì²´í¬
      if (document.querySelectorAll(".matched").length === cards.length) {
        showMessage(`Stage ${stage} Clear!`);
        stage = stage === 3 ? 1 : stage + 1;
        setTimeout(() => startStage(), 2000);
      }
    }

    // ì´ˆê¸° ì‹œìž‘
    startStage();
  </script>
</body>
</html>
