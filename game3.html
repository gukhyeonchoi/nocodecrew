<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Evo2048 - ëª¬ìŠ¤í„° í•©ì²´ & ì „íˆ¬</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #faf8ef 0%, #e4dede 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
    }
    
    h1 {
      color: #776e65;
      margin-bottom: 15px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    
    .stats-container {
      display: flex;
      gap: 20px;
      margin: 10px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.8);
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      font-weight: bold;
      color: #776e65;
    }
    
    .stat-item.unlock {
      background: linear-gradient(145deg, #3498db, #2980b9);
      color: white;
      animation: unlock-pulse 0.8s ease;
    }
    
    @keyframes unlock-pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); box-shadow: 0 0 15px rgba(52, 152, 219, 0.5); }
      100% { transform: scale(1); }
    }
    
    #battle-container {
      max-width: 500px;
      width: 100%;
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      margin-bottom: 20px;
    }
    
    #battle-log-container {
      max-width: 500px;
      width: 100%;
      background: linear-gradient(145deg, #f8f9fa, #e9ecef);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }
    
    #battle-log-container h3 {
      color: #776e65;
      margin-bottom: 10px;
      text-align: center;
    }
    
    #battle-field {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      background: linear-gradient(145deg, #bbada0, #a8998f);
      padding: 15px;
      border-radius: 12px;
    }
    
    .battle-tile {
      width: 100%;
      height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      border-radius: 10px;
      background: rgba(238, 228, 218, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      padding: 8px;
    }
    
    .battle-tile.player {
      box-shadow: 0 6px 12px rgba(46, 204, 113, 0.4);
    }
    
    /* ì•„êµ° ëª¬ìŠ¤í„°ë³„ íƒ€ì…ì— ë§ëŠ” ë°°ê²½ìƒ‰ (ëª¨ë“  ë ˆë²¨ ëŒ€ì‘) */
    .battle-tile.player.slime { 
      background: linear-gradient(145deg, #2ecc71, #27ae60) !important; 
      box-shadow: 0 6px 12px rgba(46, 204, 113, 0.4) !important;
    }
    .battle-tile.player.slime.level-2 { 
      background: linear-gradient(145deg, #27ae60, #1e8449) !important; 
      box-shadow: 0 6px 12px rgba(39, 174, 96, 0.4) !important;
    }
    .battle-tile.player.slime.level-3 { 
      background: linear-gradient(145deg, #1e8449, #145a32) !important; 
      box-shadow: 0 6px 12px rgba(30, 132, 73, 0.4) !important;
    }
    /* ë ˆë²¨ 4 ì´ìƒ ìŠ¬ë¼ì„ */
    .battle-tile.player.slime.level-4,
    .battle-tile.player.slime.level-5,
    .battle-tile.player.slime.level-6,
    .battle-tile.player.slime.level-7,
    .battle-tile.player.slime.level-8,
    .battle-tile.player.slime.level-9,
    .battle-tile.player.slime.level-10 { 
      background: linear-gradient(145deg, #145a32, #0d3d22) !important; 
      box-shadow: 0 6px 12px rgba(20, 90, 50, 0.4) !important;
    }
    
    .battle-tile.player.mushroom { 
      background: linear-gradient(145deg, #e74c3c, #c0392b) !important; 
      box-shadow: 0 6px 12px rgba(231, 76, 60, 0.4) !important;
    }
    .battle-tile.player.mushroom.level-2 { 
      background: linear-gradient(145deg, #c0392b, #962d22) !important; 
      box-shadow: 0 6px 12px rgba(192, 57, 43, 0.4) !important;
    }
    .battle-tile.player.mushroom.level-3 { 
      background: linear-gradient(145deg, #962d22, #641e16) !important; 
      box-shadow: 0 6px 12px rgba(150, 45, 34, 0.4) !important;
    }
    /* ë ˆë²¨ 4 ì´ìƒ ë²„ì„¯ */
    .battle-tile.player.mushroom.level-4,
    .battle-tile.player.mushroom.level-5,
    .battle-tile.player.mushroom.level-6,
    .battle-tile.player.mushroom.level-7,
    .battle-tile.player.mushroom.level-8,
    .battle-tile.player.mushroom.level-9,
    .battle-tile.player.mushroom.level-10 { 
      background: linear-gradient(145deg, #641e16, #4a170f) !important; 
      box-shadow: 0 6px 12px rgba(100, 30, 22, 0.4) !important;
    }
    
    .battle-tile.player.golem { 
      background: linear-gradient(145deg, #95a5a6, #7f8c8d) !important; 
      box-shadow: 0 6px 12px rgba(149, 165, 166, 0.4) !important;
    }
    .battle-tile.player.golem.level-2 { 
      background: linear-gradient(145deg, #7f8c8d, #566573) !important; 
      box-shadow: 0 6px 12px rgba(127, 140, 141, 0.4) !important;
    }
    .battle-tile.player.golem.level-3 { 
      background: linear-gradient(145deg, #566573, #2c3e50) !important; 
      box-shadow: 0 6px 12px rgba(86, 101, 115, 0.4) !important;
    }
    /* ë ˆë²¨ 4 ì´ìƒ ê³¨ë ˜ */
    .battle-tile.player.golem.level-4,
    .battle-tile.player.golem.level-5,
    .battle-tile.player.golem.level-6,
    .battle-tile.player.golem.level-7,
    .battle-tile.player.golem.level-8,
    .battle-tile.player.golem.level-9,
    .battle-tile.player.golem.level-10 { 
      background: linear-gradient(145deg, #2c3e50, #1a252f) !important; 
      box-shadow: 0 6px 12px rgba(44, 62, 80, 0.4) !important;
    }
    
    .battle-tile.player.dragon { 
      background: linear-gradient(145deg, #3498db, #2980b9) !important; 
      box-shadow: 0 6px 12px rgba(52, 152, 219, 0.4) !important;
    }
    .battle-tile.player.dragon.level-2 { 
      background: linear-gradient(145deg, #2980b9, #1f618d) !important; 
      box-shadow: 0 6px 12px rgba(41, 128, 185, 0.4) !important;
    }
    .battle-tile.player.dragon.level-3 { 
      background: linear-gradient(145deg, #1f618d, #154360) !important; 
      box-shadow: 0 6px 12px rgba(31, 97, 141, 0.4) !important;
    }
    /* ë ˆë²¨ 4 ì´ìƒ ë“œë˜ê³¤ */
    .battle-tile.player.dragon.level-4,
    .battle-tile.player.dragon.level-5,
    .battle-tile.player.dragon.level-6,
    .battle-tile.player.dragon.level-7,
    .battle-tile.player.dragon.level-8,
    .battle-tile.player.dragon.level-9,
    #commander-container {
      max-width: 500px;
      width: 100%;
      background: linear-gradient(145deg, #3498db, #2980b9);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
      margin-bottom: 15px;
      color: white;
      text-align: center;
    }
    
    #commander-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      background: rgba(0,0,0,0.2);
      padding: 12px;
      border-radius: 8px;
      margin-top: 8px;
    }
    
    .commander-icon {
      font-size: 2.5rem;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
    }
    
    .commander-stats {
      flex: 1;
      text-align: left;
    }
    
    .commander-name {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 4px;
      color: #f1c40f;
    }
    
    .commander-hp-container {
      width: 100%;
    }
    
    .commander-hp-bar {
      width: 100%;
      height: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid rgba(241, 196, 15, 0.5);
    }
    
    .commander-hp-fill {
      height: 100%;
      background: linear-gradient(90deg, #f1c40f, #f39c12);
      transition: width 0.5s ease;
      border-radius: 6px;
    }
    
    .commander-hp-text {
      color: rgba(255,255,255,0.9);
      margin-top: 4px;
      font-weight: bold;
      text-align: center;
      font-size: 0.9rem;
    }
    
    .battle-tile.enemy {
      background: linear-gradient(145deg, #e74c3c, #c0392b);
      box-shadow: 0 6px 12px rgba(231, 76, 60, 0.4);
    }
    
    .battle-tile.player:hover, .battle-tile.enemy:hover {
      transform: scale(1.05);
    }
    
    .monster-level {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.95);
      font-weight: bold;
      margin-bottom: 2px;
    }
    
    .monster-icon {
      font-size: 2.8rem;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.4));
      margin: 5px 0;
    }
    
    .monster-stats {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
    }
    
    .hp-container {
      width: 90%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .hp-bar {
      width: 100%;
      height: 8px;
      background: rgba(255,255,255,0.3);
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.5);
      margin-bottom: 2px;
    }
    
    .hp-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #27ae60, #2ecc71);
      transition: width 0.5s ease;
      border-radius: 8px;
    }
    
    .stats-row {
      display: flex;
      justify-content: space-between;
      width: 100%;
      gap: 5px;
    }
    
    .hp-text {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.95);
      font-weight: bold;
      flex: 1;
      text-align: center;
    }
    
    .attack-text {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.85);
      font-weight: bold;
      flex: 1;
      text-align: center;
    }
      max-width: 500px;
      width: 100%;
      background: linear-gradient(145deg, #3498db, #2980b9);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
      margin-bottom: 15px;
      color: white;
      text-align: center;
    }
    
    #commander-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      background: rgba(0,0,0,0.2);
      padding: 12px;
      border-radius: 8px;
      margin-top: 8px;
    }
    
    .commander-icon {
      font-size: 2.5rem;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
    }
    
    .commander-stats {
      flex: 1;
      text-align: left;
    }
    
    .commander-name {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 4px;
      color: #f1c40f;
    }
    
    .commander-hp-container {
      width: 100%;
    }
    
    .commander-hp-bar {
      width: 100%;
      height: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid rgba(241, 196, 15, 0.5);
    }
    
    .commander-hp-fill {
      height: 100%;
      background: linear-gradient(90deg, #f1c40f, #f39c12);
      transition: width 0.5s ease;
      border-radius: 6px;
    }
    
    .commander-hp-text {
      color: rgba(255,255,255,0.9);
      margin-top: 4px;
      font-weight: bold;
      text-align: center;
      font-size: 0.9rem;
    }
      max-width: 500px;
      width: 100%;
      background: linear-gradient(145deg, #2c3e50, #34495e);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(44, 62, 80, 0.3);
      margin-bottom: 15px;
      color: white;
      text-align: center;
    }
    
    #commander-container {
      max-width: 500px;
      width: 100%;
      background: linear-gradient(145deg, #3498db, #2980b9);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
      margin-bottom: 15px;
      color: white;
      text-align: center;
    }
    
    #commander-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      background: rgba(0,0,0,0.2);
      padding: 12px;
      border-radius: 8px;
      margin-top: 8px;
    }
    
    .commander-icon {
      font-size: 2.5rem;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
    }
    
    .commander-stats {
      flex: 1;
      text-align: left;
    }
    
    .commander-name {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 4px;
      color: #f1c40f;
    }
    
    .commander-hp-container {
      width: 100%;
    }
    
    .commander-hp-bar {
      width: 100%;
      height: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid rgba(241, 196, 15, 0.5);
    }
    
    .commander-hp-fill {
      height: 100%;
      background: linear-gradient(90deg, #f1c40f, #f39c12);
      transition: width 0.5s ease;
      border-radius: 6px;
    }
    
    .commander-hp-text {
      color: rgba(255,255,255,0.9);
      margin-top: 4px;
      font-weight: bold;
      text-align: center;
      font-size: 0.9rem;
    }

    #game-container {
      background: linear-gradient(145deg, #bbada0, #a8998f);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      max-width: 380px;
      width: 100%;
    }
    
    #game {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      background: transparent;
      padding: 0;
    }
    
    .tile {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.2s ease;
      font-size: 2.2rem;
      color: #fff;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      min-height: 70px;
    }
    
    .tile::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(255,255,255,0.1), transparent);
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    .tile:hover::before {
      opacity: 1;
    }
    
    .tile.empty {
      background: rgba(238, 228, 218, 0.35);
      border: 2px dashed rgba(119, 110, 101, 0.3);
    }
    
    /* ëª¬ìŠ¤í„°ë³„ ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ ê°œì„  */
    .tile.slime.level-1 { background: linear-gradient(145deg, #2ecc71, #27ae60); }
    .tile.slime.level-2 { background: linear-gradient(145deg, #27ae60, #1e8449); }
    .tile.slime.level-3 { background: linear-gradient(145deg, #1e8449, #145a32); }
    
    .tile.mushroom.level-1 { background: linear-gradient(145deg, #e74c3c, #c0392b); }
    .tile.mushroom.level-2 { background: linear-gradient(145deg, #c0392b, #962d22); }
    .tile.mushroom.level-3 { background: linear-gradient(145deg, #962d22, #641e16); }
    
    .tile.golem.level-1 { background: linear-gradient(145deg, #95a5a6, #7f8c8d); }
    .tile.golem.level-2 { background: linear-gradient(145deg, #7f8c8d, #566573); }
    .tile.golem.level-3 { background: linear-gradient(145deg, #566573, #2c3e50); }
    
    .tile.dragon.level-1 { background: linear-gradient(145deg, #3498db, #2980b9); }
    .tile.dragon.level-2 { background: linear-gradient(145deg, #2980b9, #1f618d); }
    .tile.dragon.level-3 { background: linear-gradient(145deg, #1f618d, #154360); }
    
    .tile-merged {
      animation: merge 0.4s ease;
      z-index: 10;
    }
    
    @keyframes merge {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); box-shadow: 0 0 20px rgba(255,255,255,0.6); }
      100% { transform: scale(1); }
    }
    
    .tile-new {
      animation: appear 0.3s ease;
    }
    
    @keyframes appear {
      0% { transform: scale(0); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    #commander-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      background: rgba(0,0,0,0.2);
      padding: 12px;
      border-radius: 8px;
      margin-top: 8px;
    }
    
    .commander-icon {
      font-size: 2.5rem;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
    }
    
    .commander-stats {
      flex: 1;
      text-align: left;
    }
    
    .commander-name {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 4px;
      color: #f1c40f;
    }
    
    .commander-hp-container {
      width: 100%;
    }
    
    .commander-hp-bar {
      width: 100%;
      height: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid rgba(241, 196, 15, 0.5);
    }
    
    .commander-hp-fill {
      height: 100%;
      background: linear-gradient(90deg, #f1c40f, #f39c12);
      transition: width 0.5s ease;
      border-radius: 6px;
    }
    
    .commander-hp-text {
      color: rgba(255,255,255,0.9);
      margin-top: 4px;
      font-weight: bold;
      text-align: center;
      font-size: 0.9rem;
    }

    #boss-container {
      max-width: 500px;
      width: 100%;
      background: linear-gradient(145deg, #2c3e50, #34495e);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(44, 62, 80, 0.3);
      margin-bottom: 15px;
      color: white;
      text-align: center;
    }
    
    #boss-monster {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      background: rgba(0,0,0,0.2);
      padding: 12px;
      border-radius: 8px;
      margin-top: 8px;
    }
    
    .boss-icon {
      font-size: 2.5rem;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
    }
    
    .boss-info {
      flex: 1;
      text-align: left;
    }
    
    .boss-name {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 4px;
      color: #e74c3c;
    }
    
    .boss-hp-container {
      width: 100%;
    }
    
    .boss-hp-bar {
      width: 100%;
      height: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid rgba(231, 76, 60, 0.5);
    }
    
    .boss-hp-fill {
      height: 100%;
      background: linear-gradient(90deg, #e74c3c, #c0392b);
      transition: width 0.5s ease;
      border-radius: 6px;
    }
    
    .boss-hp-text {
      color: rgba(255,255,255,0.9);
      margin-top: 4px;
      font-weight: bold;
      text-align: center;
      font-size: 0.9rem;
    }
    
    #battle-container {
      max-width: 500px;
      width: 100%;
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      background: linear-gradient(145deg, #bbada0, #a8998f);
      padding: 15px;
      border-radius: 12px;
    }
    
    .battle-tile {
      width: 100%;
      height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      border-radius: 10px;
      background: rgba(238, 228, 218, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      padding: 8px;
    }
    
    .battle-tile.player {
      background: linear-gradient(145deg, #2ecc71, #27ae60);
      box-shadow: 0 6px 12px rgba(46, 204, 113, 0.4);
    }
    
    .battle-tile.enemy {
      background: linear-gradient(145deg, #e74c3c, #c0392b);
      box-shadow: 0 6px 12px rgba(231, 76, 60, 0.4);
    }
    
    .battle-tile.player:hover, .battle-tile.enemy:hover {
      transform: scale(1.05);
    }

    .battle-tile.level-up {
      animation: level-up 0.8s ease;
    }
    
    @keyframes level-up {
      0% { transform: scale(1); background: linear-gradient(145deg, #2ecc71, #27ae60); }
      25% { transform: scale(1.15); background: linear-gradient(145deg, #f1c40f, #f39c12); box-shadow: 0 0 20px rgba(241, 196, 15, 0.7); }
      50% { transform: scale(1.1); background: linear-gradient(145deg, #e74c3c, #c0392b); box-shadow: 0 0 25px rgba(231, 76, 60, 0.8); }
      75% { transform: scale(1.05); background: linear-gradient(145deg, #9b59b6, #8e44ad); box-shadow: 0 0 30px rgba(155, 89, 182, 0.9); }
      100% { transform: scale(1); box-shadow: 0 6px 12px rgba(46, 204, 113, 0.4); }
    }
    
    .monster-level {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.95);
      font-weight: bold;
      margin-bottom: 2px;
    }
    
    .monster-icon {
      font-size: 2.8rem;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.4));
      margin: 5px 0;
    }
    
    .monster-stats {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
    }
    
    .hp-container {
      width: 90%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .hp-bar {
      width: 100%;
      height: 8px;
      background: rgba(255,255,255,0.3);
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.5);
      margin-bottom: 2px;
    }
    
    .hp-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #27ae60, #2ecc71);
      transition: width 0.5s ease;
      border-radius: 8px;
    }
    
    .stats-row {
      display: flex;
      justify-content: space-between;
      width: 100%;
      gap: 5px;
    }
    
    .hp-text {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.95);
      font-weight: bold;
      flex: 1;
      text-align: center;
    }
    
    .attack-text {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.85);
      font-weight: bold;
      flex: 1;
      text-align: center;
    }
    
    #battle-log {
      max-height: 140px;
      overflow-y: auto;
      font-size: 0.95rem;
      color: #776e65;
      text-align: left;
      padding: 15px;
      background: rgba(238, 228, 218, 0.6);
      border-radius: 8px;
      border: 2px solid rgba(187, 173, 160, 0.3);
      line-height: 1.5;
    }
    
    #battle-log::-webkit-scrollbar {
      width: 6px;
    }
    
    #battle-log::-webkit-scrollbar-track {
      background: rgba(187, 173, 160, 0.3);
      border-radius: 3px;
    }
    
    #battle-log::-webkit-scrollbar-thumb {
      background: #bbada0;
      border-radius: 3px;
    }
    
    #battle-log {
      max-height: 140px;
      overflow-y: auto;
      font-size: 0.95rem;
      color: #776e65;
      text-align: left;
      padding: 15px;
      background: rgba(238, 228, 218, 0.6);
      border-radius: 8px;
      border: 2px solid rgba(187, 173, 160, 0.3);
      line-height: 1.5;
    }
    
    #battle-log::-webkit-scrollbar {
      width: 6px;
    }
    
    #battle-log::-webkit-scrollbar-track {
      background: rgba(187, 173, 160, 0.3);
      border-radius: 3px;
    }
    
    #battle-log::-webkit-scrollbar-thumb {
      background: #bbada0;
      border-radius: 3px;
    }

    #commander-container {
      max-width: 500px;
      width: 100%;
      background: linear-gradient(145deg, #3498db, #2980b9);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
      margin-bottom: 15px;
      color: white;
      text-align: center;
    }
      background: linear-gradient(145deg, #bbada0, #a8998f);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      max-width: 380px;
      width: 100%;
    }
    
    #game {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      background: transparent;
      padding: 0;
    }
    
    .tile {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.2s ease;
      font-size: 2.2rem;
      color: #fff;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      min-height: 70px;
    }
    
    .tile::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(255,255,255,0.1), transparent);
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    .tile:hover::before {
      opacity: 1;
    }
    
    .tile.empty {
      background: rgba(238, 228, 218, 0.35);
      border: 2px dashed rgba(119, 110, 101, 0.3);
    }
    
    /* ëª¬ìŠ¤í„°ë³„ ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ ê°œì„  */
    .tile.slime.level-1 { background: linear-gradient(145deg, #2ecc71, #27ae60); }
    .tile.slime.level-2 { background: linear-gradient(145deg, #27ae60, #1e8449); }
    .tile.slime.level-3 { background: linear-gradient(145deg, #1e8449, #145a32); }
    
    .tile.mushroom.level-1 { background: linear-gradient(145deg, #e74c3c, #c0392b); }
    .tile.mushroom.level-2 { background: linear-gradient(145deg, #c0392b, #962d22); }
    .tile.mushroom.level-3 { background: linear-gradient(145deg, #962d22, #641e16); }
    
    .tile.golem.level-1 { background: linear-gradient(145deg, #95a5a6, #7f8c8d); }
    .tile.golem.level-2 { background: linear-gradient(145deg, #7f8c8d, #566573); }
    .tile.golem.level-3 { background: linear-gradient(145deg, #566573, #2c3e50); }
    
    .tile.dragon.level-1 { background: linear-gradient(145deg, #3498db, #2980b9); }
    .tile.dragon.level-2 { background: linear-gradient(145deg, #2980b9, #1f618d); }
    .tile.dragon.level-3 { background: linear-gradient(145deg, #1f618d, #154360); }
    
    .tile-merged {
      animation: merge 0.4s ease;
      z-index: 10;
    }
    
    @keyframes merge {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); box-shadow: 0 0 20px rgba(255,255,255,0.6); }
      100% { transform: scale(1); }
    }
    
    .tile-new {
      animation: appear 0.3s ease;
    }
    
    @keyframes appear {
      0% { transform: scale(0); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .buttons-container {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    button {
      background: linear-gradient(145deg, #8f7a66, #776e65);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    #undo {
      background: linear-gradient(145deg, #3498db, #2980b9);
    }
    
    #instructions {
      font-size: 0.95rem;
      color: #776e65;
      max-width: 500px;
      margin: 15px auto;
      line-height: 1.5;
      background: rgba(255,255,255,0.7);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .game-over-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .game-over-overlay.show {
      opacity: 1;
      visibility: visible;
    }
    
    .game-over-content {
      background: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      max-width: 300px;
    }
    
    @media (max-width: 500px) {
      body { padding: 10px; }
      #game, #battle-field { gap: 8px; }
      .tile { font-size: 1.8rem; min-height: 60px; }
      .monster-icon { font-size: 2.2rem; }
      .battle-tile { height: 100px; padding: 6px; }
      .hp-bar { height: 6px; }
      #battle-container { padding: 15px; }
      .stats-container { gap: 10px; }
      .stat-item { padding: 8px 12px; font-size: 0.9rem; }
      .boss-icon { font-size: 2rem; }
      #game-container { max-width: 320px; padding: 12px; }
      .hp-text, .attack-text { font-size: 0.6rem; }
      .monster-level { font-size: 0.7rem; }
    }
  </style>
</head>
<body>
  <h1>ğŸ® Evo2048 - ëª¬ìŠ¤í„° í•©ì²´ & ì „íˆ¬</h1>
  
  <div class="stats-container">
    <div class="stat-item" id="score">ì ìˆ˜: 0</div>
    <div class="stat-item" id="high-score">ìµœê³  ì ìˆ˜: 0</div>
    <div class="stat-item" id="monsters-count">ì†Œí™˜ëœ ëª¬ìŠ¤í„°: 0</div>
    <div class="stat-item" id="unlock-status">ì–¸ë½: ìŠ¬ë¼ì„, ë²„ì„¯ (2/4)</div>
  </div>
  
  <div id="boss-container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
      <h3 style="margin: 0;">ğŸ‘‘ ë³´ìŠ¤ ëª¬ìŠ¤í„°</h3>
      <div id="boss-kill-count" style="background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 15px; font-size: 0.9rem; font-weight: bold;">ì²˜ì¹˜: 0ë§ˆë¦¬</div>
    </div>
    <div id="boss-monster">
      <div class="boss-icon" id="boss-icon">ğŸ²</div>
      <div class="boss-info">
        <div class="boss-name" id="boss-name">ì „ì„¤ ë“œë˜ê³¤</div>
        <div class="boss-hp-container">
          <div class="boss-hp-bar">
            <div class="boss-hp-fill" id="boss-hp-fill" style="width: 100%"></div>
          </div>
          <div class="boss-hp-text" id="boss-hp-text">1000/1000</div>
        </div>
      </div>
    </div>
  </div>
  
  <div id="battle-container">
    <div id="battle-field"></div>
  </div>
  
  <div id="commander-container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
      <h3 style="margin: 0;">ğŸ›¡ï¸ ì•„êµ° ëŒ€ì¥</h3>
    </div>
    <div id="commander-info">
      <div class="commander-icon" id="commander-icon">ğŸ›¡ï¸</div>
      <div class="commander-stats">
        <div class="commander-name" id="commander-name">ìš©ê°í•œ ì§€íœ˜ê´€</div>
        <div class="commander-hp-container">
          <div class="commander-hp-bar">
            <div class="commander-hp-fill" id="commander-hp-fill" style="width: 100%"></div>
          </div>
          <div class="commander-hp-text" id="commander-hp-text">1000/1000</div>
        </div>
      </div>
    </div>
  </div>
  
  <div id="battle-log-container">
    <h3>ğŸ“œ ì „íˆ¬ ìƒí™©</h3>
    <div id="battle-log"></div>
  </div>
  
  <div id="game-container">
    <div id="game"></div>
  </div>
  
  <div id="instructions">
    ğŸ¯ <strong>ê²Œì„ ë°©ë²•:</strong> í™”ì‚´í‘œ í‚¤ë‚˜ ìŠ¤ì™€ì´í”„ë¡œ 2048ì„ í”Œë ˆì´í•´ ë ˆë²¨ 3 ëª¬ìŠ¤í„°ë¥¼ ì†Œí™˜í•˜ì„¸ìš”!<br>
    âš”ï¸ <strong>ì „íˆ¬ ìˆœì„œ:</strong> ë³´ìŠ¤ â†’ ì•„êµ° ëª¬ìŠ¤í„° â†’ ì•„êµ° ëŒ€ì¥ ìˆœìœ¼ë¡œ ê³µê²©!<br>
    ğŸ”“ <strong>ì–¸ë½:</strong> 3000ì ì— ê³¨ë ˜, 5000ì ì— ë“œë˜ê³¤ ì–¸ë½!<br>
    ğŸ² <strong>ëª¬ìŠ¤í„° íŠ¹ì„±:</strong> ìŠ¬ë¼ì„(ì²´ë ¥í˜•), ë²„ì„¯(ë…ê³µê²©), ê³¨ë ˜(ë°©ì–´í˜•), ë“œë˜ê³¤(ê· í˜•í˜•)<br>
    ğŸ›¡ï¸ <strong>ëŒ€ì¥ ë³´í˜¸:</strong> ì•„êµ° ëŒ€ì¥ì´ ì£½ìœ¼ë©´ ì¦‰ì‹œ ê²Œì„ ì˜¤ë²„! ëª¬ìŠ¤í„°ë¡œ ëŒ€ì¥ì„ ì§€í‚¤ì„¸ìš”!<br>
    ğŸ† <strong>ëª©í‘œ:</strong> ê°™ì€ íƒ€ì…ì„ ê°•í™”í•´ì„œ íŠ¹í™” ëª¬ìŠ¤í„°ë¥¼ ë§Œë“¤ê³  ë³´ìŠ¤ë¥¼ ë¬¼ë¦¬ì¹˜ì„¸ìš”!
  </div>
  
  <div class="buttons-container">
    <button id="restart">ğŸ”„ ê²Œì„ ì¬ì‹œì‘</button>
    <button id="undo">â†©ï¸ ë˜ëŒë¦¬ê¸°</button>
  </div>

  <div class="game-over-overlay" id="game-over-overlay">
    <div class="game-over-content">
      <h2>ğŸ¯ ê²Œì„ ì˜¤ë²„!</h2>
      <p id="final-score"></p>
      <button onclick="restartGame(); hideGameOver();">ë‹¤ì‹œ ì‹œì‘</button>
    </div>
  </div>

  <script>
    // ê²Œì„ ìƒìˆ˜
    const GAME_CONFIG = {
      SIZE: 4,
      MAX_BATTLE_MONSTERS: 3,
      BASE_HP: 50,
      BASE_ATTACK: 10,
      SCORE_MULTIPLIER: 10,
      DEFEAT_BONUS: 100,
      BOSS_AOE_TURNS: 4 // ë³´ìŠ¤ ê´‘ì—­ ê³µê²© ì£¼ê¸° (í„´)
    };

    // ê²Œì„ ìƒíƒœ
    const gameState = {
      score: 0,
      highScore: parseInt(localStorage.getItem('evo2048-highScore') || '0'),
      board: [],
      battleMonsters: [],
      enemyMonster: null,
      bossMonster: null,
      bossLevel: 1, // ë³´ìŠ¤ ë‹¨ê³„ ì¶”ê°€
      bossKillCount: 0, // ë³´ìŠ¤ ì²˜ì¹˜ íšŸìˆ˜ ì¶”ê°€
      bossTurnCounter: 0, // ë³´ìŠ¤ í„´ ì¹´ìš´í„° ì¶”ê°€
      commander: null, // ì•„êµ° ëŒ€ì¥ ì¶”ê°€
      monstersSpawned: 0,
      // ë˜ëŒë¦¬ê¸°ìš© ìƒíƒœ
      previous: {
        board: [],
        score: 0,
        battleMonsters: [],
        enemyMonster: null,
        bossMonster: null,
        bossLevel: 1,
        bossKillCount: 0,
        bossTurnCounter: 0,
        commander: null,
        monstersSpawned: 0
      }
    };

    // ëª¬ìŠ¤í„° ë°ì´í„° ìµœì í™” (íŠ¹ì„± ì¶”ê°€)
    const MONSTERS = {
      slime: { 
        1: 'ğŸŸ¢', 2: 'ğŸ’š', 3: 'ğŸ¸', 
        name: 'ìŠ¬ë¼ì„',
        hpMultiplier: 1.5,  // ì²´ë ¥ 150%
        attackMultiplier: 0.8,  // ê³µê²©ë ¥ 80%
        specialty: 'ì²´ë ¥í˜•',
        description: 'ë†’ì€ ì²´ë ¥ê³¼ íšŒë³µë ¥ì„ ê°€ì§„ íƒ±ì»¤'
      },
      mushroom: { 
        1: 'ğŸ„', 2: 'ğŸ„â€ğŸŸ«', 3: 'ğŸ”´', 
        name: 'ë²„ì„¯',
        hpMultiplier: 0.8,  // ì²´ë ¥ 80%
        attackMultiplier: 1.3,  // ê³µê²©ë ¥ 130%
        specialty: 'ë… ê³µê²©',
        description: 'ê°•ë ¥í•œ ë… ê³µê²©ìœ¼ë¡œ ë†’ì€ ë°ë¯¸ì§€'
      },
      golem: { 
        1: 'ğŸª¨', 2: 'ğŸ—¿', 3: 'âš«', 
        name: 'ê³¨ë ˜',
        hpMultiplier: 1.8,  // ì²´ë ¥ 180%
        attackMultiplier: 0.6,  // ê³µê²©ë ¥ 60%
        specialty: 'ë°©ì–´í˜•',
        description: 'ìµœê°•ì˜ ë°©ì–´ë ¥ê³¼ ì²´ë ¥ì„ ìë‘'
      },
      dragon: { 
        1: 'ğŸ¦', 2: 'ğŸ‰', 3: 'ğŸ²', 
        name: 'ë“œë˜ê³¤',
        hpMultiplier: 1.0,  // ì²´ë ¥ 100%
        attackMultiplier: 1.5,  // ê³µê²©ë ¥ 150%
        specialty: 'ê· í˜•í˜•',
        description: 'ê°•ë ¥í•œ ê³µê²©ë ¥ê³¼ ì ë‹¹í•œ ì²´ë ¥'
      }
    };
    const MONSTER_TYPES = Object.keys(MONSTERS);

    // DOM ìš”ì†Œ ìºì‹±
    const elements = {
      game: document.getElementById("game"),
      score: document.getElementById("score"),
      highScore: document.getElementById("high-score"),
      monstersCount: document.getElementById("monsters-count"),
      unlockStatus: document.getElementById("unlock-status"),
      battleField: document.getElementById("battle-field"),
      battleLog: document.getElementById("battle-log"),
      gameOverOverlay: document.getElementById("game-over-overlay"),
      finalScore: document.getElementById("final-score"),
      bossIcon: document.getElementById("boss-icon"),
      bossName: document.getElementById("boss-name"),
      bossHpFill: document.getElementById("boss-hp-fill"),
      bossHpText: document.getElementById("boss-hp-text"),
      bossKillCount: document.getElementById("boss-kill-count"),
      commanderIcon: document.getElementById("commander-icon"),
      commanderName: document.getElementById("commander-name"),
      commanderHpFill: document.getElementById("commander-hp-fill"),
      commanderHpText: document.getElementById("commander-hp-text")
    };

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    const utils = {
      deepClone: (obj) => JSON.parse(JSON.stringify(obj)),
      
      getRandomMonsterType: () => {
        // ì ìˆ˜ì— ë”°ë¼ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¬ìŠ¤í„° ì¢…ë¥˜ ê²°ì •
        let availableTypes = [];
        
        if (gameState.score < 3000) {
          // 3000ì  ë¯¸ë§Œ: 2ì¢…ë¥˜ë§Œ (ìŠ¬ë¼ì„, ë²„ì„¯)
          availableTypes = ['slime', 'mushroom'];
        } else if (gameState.score < 5000) {
          // 3000-4999ì : 3ì¢…ë¥˜ (ê³¨ë ˜ ì¶”ê°€)
          availableTypes = ['slime', 'mushroom', 'golem'];
        } else {
          // 5000ì  ì´ìƒ: ëª¨ë“  4ì¢…ë¥˜
          availableTypes = MONSTER_TYPES;
        }
        
        return availableTypes[Math.floor(Math.random() * availableTypes.length)];
      },
      
      getEmptyTiles: () => {
        const empties = [];
        for (let r = 0; r < GAME_CONFIG.SIZE; r++) {
          for (let c = 0; c < GAME_CONFIG.SIZE; c++) {
            if (!gameState.board[r][c]) empties.push([r, c]);
          }
        }
        return empties;
      },
      
      addBattleLog: (message) => {
        const p = document.createElement("p");
        p.textContent = `âš”ï¸ ${message}`;
        p.style.margin = "5px 0";
        elements.battleLog.appendChild(p);
        elements.battleLog.scrollTop = elements.battleLog.scrollHeight;
        
        // ë¡œê·¸ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
        if (elements.battleLog.children.length > 20) {
          elements.battleLog.removeChild(elements.battleLog.firstChild);
        }
      }
    };

    // ê²Œì„ ì´ˆê¸°í™”
    function initBoard() {
      gameState.board = Array(GAME_CONFIG.SIZE).fill(null).map(() => Array(GAME_CONFIG.SIZE).fill(null));
      gameState.battleMonsters = [];
      gameState.enemyMonster = null;
      gameState.bossLevel = 1; // ë³´ìŠ¤ ë ˆë²¨ ì´ˆê¸°í™”
      gameState.bossKillCount = 0; // ë³´ìŠ¤ ì²˜ì¹˜ íšŸìˆ˜ ì´ˆê¸°í™”
      gameState.bossTurnCounter = 0; // ë³´ìŠ¤ í„´ ì¹´ìš´í„° ì´ˆê¸°í™”
      gameState.monstersSpawned = 0;
      elements.battleLog.innerHTML = "<p style='color: #3498db; font-weight: bold;'>ğŸ® ê²Œì„ ì‹œì‘! ëª¬ìŠ¤í„°ë¥¼ ì†Œí™˜í•˜ì—¬ ì „íˆ¬ë¥¼ ì¤€ë¹„í•˜ì„¸ìš”!</p>";
      
      // ì•„êµ° ëŒ€ì¥ ì´ˆê¸°í™”
      createCommander();
      
      // ë³´ìŠ¤ ëª¬ìŠ¤í„° ì´ˆê¸°í™”
      createBossMonster();
      
      addRandomTile();
      addRandomTile();
      // ê²Œì„ ì‹œì‘ ì‹œì—ëŠ” ì¼ë°˜ ì ì„ ìƒì„±í•˜ì§€ ì•ŠìŒ (ëª¬ìŠ¤í„° ì†Œí™˜ í›„ ì‹œì‘)
      updateDisplay();
    }

    // ì•„êµ° ëŒ€ì¥ ìƒì„±
    function createCommander() {
      gameState.commander = {
        name: 'ìš©ê°í•œ ì§€íœ˜ê´€',
        icon: 'ğŸ›¡ï¸',
        hp: 1000,
        maxHp: 1000
      };
      
      updateCommanderDisplay();
      utils.addBattleLog(`ğŸ›¡ï¸ ì•„êµ° ëŒ€ì¥ ${gameState.commander.name} ì¤€ë¹„ ì™„ë£Œ! (HP: 1000)`);
    }

    // ì•„êµ° ëŒ€ì¥ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateCommanderDisplay() {
      if (!gameState.commander) return;
      
      const commander = gameState.commander;
      elements.commanderIcon.textContent = commander.icon;
      elements.commanderName.textContent = commander.name;
      
      // ëŒ€ì¥ HPì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
      const commanderHpPercent = (commander.hp / commander.maxHp) * 100;
      let commanderHpColor;
      
      if (commanderHpPercent > 75) {
        commanderHpColor = 'linear-gradient(90deg, #f1c40f, #f39c12)';
      } else if (commanderHpPercent > 50) {
        commanderHpColor = 'linear-gradient(90deg, #e67e22, #d35400)';
      } else if (commanderHpPercent > 25) {
        commanderHpColor = 'linear-gradient(90deg, #e74c3c, #c0392b)';
      } else {
        commanderHpColor = 'linear-gradient(90deg, #8e44ad, #9b59b6)';
      }
      
      elements.commanderHpFill.style.width = `${commanderHpPercent}%`;
      elements.commanderHpFill.style.background = commanderHpColor;
      elements.commanderHpText.textContent = `${commander.hp}/${commander.maxHp}`;
    }

    // ë³´ìŠ¤ ëª¬ìŠ¤í„° ìƒì„±
    function createBossMonster() {
      const bossTypes = [
        { type: 'dragon', name: 'ë“œë˜ê³¤', icon: 'ğŸ²' },
        { type: 'golem', name: 'ê³¨ë ˜', icon: 'ğŸ—¿' },
        { type: 'slime', name: 'ìŠ¬ë¼ì„', icon: 'ğŸ‘‘' },
        { type: 'mushroom', name: 'ë²„ì„¯', icon: 'â˜ ï¸' }
      ];
      
      const boss = bossTypes[Math.floor(Math.random() * bossTypes.length)];
      
      // ë³´ìŠ¤ ë ˆë²¨ì— ë”°ë¥¸ ì´ë¦„ê³¼ ëŠ¥ë ¥ì¹˜ ì¦ê°€
      let bossName, bossHp, bossIcon;
      
      if (gameState.bossLevel === 1) {
        bossName = `${boss.name} ë³´ìŠ¤`;
        bossHp = 1000;
        bossIcon = boss.icon;
      } else if (gameState.bossLevel <= 3) {
        bossName = `ê°•í™”ëœ ${boss.name}`;
        bossHp = 1000 + (gameState.bossLevel - 1) * 500;
        bossIcon = boss.icon;
      } else if (gameState.bossLevel <= 5) {
        bossName = `ì „ì„¤ì˜ ${boss.name}`;
        bossHp = 2000 + (gameState.bossLevel - 3) * 800;
        bossIcon = boss.icon;
      } else {
        bossName = `ê¶ê·¹ì˜ ${boss.name}`;
        bossHp = 4000 + (gameState.bossLevel - 5) * 1000;
        bossIcon = boss.icon;
      }
      
      gameState.bossMonster = {
        type: boss.type,
        level: Math.min(5 + Math.floor(gameState.bossLevel / 3), 10), // ë ˆë²¨ë„ ì¦ê°€
        name: bossName,
        icon: bossIcon,
        hp: bossHp,
        maxHp: bossHp
      };
      
      updateBossDisplay();
      utils.addBattleLog(`ğŸ‘‘ ${gameState.bossLevel}ë‹¨ê³„ ë³´ìŠ¤ ${bossName} ë“±ì¥! (HP: ${bossHp})`);
    }

    // ë³´ìŠ¤ ëª¬ìŠ¤í„° í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateBossDisplay() {
      if (!gameState.bossMonster) return;
      
      const boss = gameState.bossMonster;
      elements.bossIcon.textContent = boss.icon;
      elements.bossName.textContent = boss.name;
      
      // ë³´ìŠ¤ ì²˜ì¹˜ íšŸìˆ˜ ì—…ë°ì´íŠ¸
      elements.bossKillCount.textContent = `ì²˜ì¹˜: ${gameState.bossKillCount}ë§ˆë¦¬`;
      
      // ë³´ìŠ¤ HPì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
      const bossHpPercent = (boss.hp / boss.maxHp) * 100;
      let bossHpColor;
      
      if (bossHpPercent > 75) {
        bossHpColor = 'linear-gradient(90deg, #e74c3c, #c0392b)';
      } else if (bossHpPercent > 50) {
        bossHpColor = 'linear-gradient(90deg, #e67e22, #d35400)';
      } else if (bossHpPercent > 25) {
        bossHpColor = 'linear-gradient(90deg, #f39c12, #f1c40f)';
      } else {
        bossHpColor = 'linear-gradient(90deg, #8e44ad, #9b59b6)';
      }
      
      elements.bossHpFill.style.width = `${bossHpPercent}%`;
      elements.bossHpFill.style.background = bossHpColor;
      elements.bossHpText.textContent = `${boss.hp}/${boss.maxHp}`;
    }

    // ëœë¤ íƒ€ì¼ ì¶”ê°€ (ì• ë‹ˆë©”ì´ì…˜ ê°œì„ )
    function addRandomTile() {
      const empties = utils.getEmptyTiles();
      if (empties.length === 0) return;
      
      const [r, c] = empties[Math.floor(Math.random() * empties.length)];
      const type = utils.getRandomMonsterType();
      gameState.board[r][c] = { type, level: 1, merged: false, isNew: true };
    }

    // í™”ë©´ ì—…ë°ì´íŠ¸ ìµœì í™”
    function updateDisplay() {
      drawBoard();
      updateStats();
      updateBattleField();
      updateCommanderDisplay();
      updateBossDisplay();
    }

    function drawBoard() {
      elements.game.innerHTML = "";
      for (let r = 0; r < GAME_CONFIG.SIZE; r++) {
        for (let c = 0; c < GAME_CONFIG.SIZE; c++) {
          const div = document.createElement("div");
          div.className = "tile";
          
          if (gameState.board[r][c]) {
            const monster = gameState.board[r][c];
            div.textContent = MONSTERS[monster.type][monster.level];
            div.classList.add(monster.type, `level-${monster.level}`);
            
            if (monster.merged) {
              div.classList.add("tile-merged");
              setTimeout(() => monster.merged = false, 400);
            }
            
            if (monster.isNew) {
              div.classList.add("tile-new");
              setTimeout(() => monster.isNew = false, 300);
            }
          } else {
            div.classList.add("empty");
          }
          elements.game.appendChild(div);
        }
      }
    }

    function updateStats() {
      const previousScore = parseInt(elements.score.textContent.split(': ')[1].replace(/,/g, '')) || 0;
      
      elements.score.textContent = `ì ìˆ˜: ${gameState.score.toLocaleString()}`;
      elements.highScore.textContent = `ìµœê³  ì ìˆ˜: ${gameState.highScore.toLocaleString()}`;
      elements.monstersCount.textContent = `ì†Œí™˜ëœ ëª¬ìŠ¤í„°: ${gameState.monstersSpawned}`;
      
      // ì–¸ë½ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateUnlockStatus(previousScore);
      
      if (gameState.score > gameState.highScore) {
        gameState.highScore = gameState.score;
        localStorage.setItem('evo2048-highScore', gameState.highScore);
        elements.highScore.style.color = '#e74c3c';
        setTimeout(() => elements.highScore.style.color = '', 1000);
      }
    }

    // ì–¸ë½ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateUnlockStatus(previousScore) {
      let unlockText = "";
      let unlockCount = 0;
      let newUnlock = false;
      
      if (gameState.score >= 5000) {
        unlockText = "ì–¸ë½: ìŠ¬ë¼ì„, ë²„ì„¯, ê³¨ë ˜, ë“œë˜ê³¤ (4/4) ğŸ‰";
        unlockCount = 4;
        newUnlock = previousScore < 5000 && gameState.score >= 5000;
      } else if (gameState.score >= 3000) {
        unlockText = "ì–¸ë½: ìŠ¬ë¼ì„, ë²„ì„¯, ê³¨ë ˜ (3/4)";
        unlockCount = 3;
        newUnlock = previousScore < 3000 && gameState.score >= 3000;
      } else {
        unlockText = "ì–¸ë½: ìŠ¬ë¼ì„, ë²„ì„¯ (2/4)";
        unlockCount = 2;
      }
      
      elements.unlockStatus.textContent = unlockText;
      
      // ìƒˆë¡œìš´ ëª¬ìŠ¤í„° ì–¸ë½ ì‹œ íŠ¹ë³„ íš¨ê³¼
      if (newUnlock) {
        elements.unlockStatus.classList.add('unlock');
        setTimeout(() => elements.unlockStatus.classList.remove('unlock'), 800);
        
        if (gameState.score >= 5000) {
          utils.addBattleLog("ğŸ² ë“œë˜ê³¤ ëª¬ìŠ¤í„° ì–¸ë½! ëª¨ë“  ëª¬ìŠ¤í„° ì‚¬ìš© ê°€ëŠ¥!");
        } else if (gameState.score >= 3000) {
          utils.addBattleLog("ğŸª¨ ê³¨ë ˜ ëª¬ìŠ¤í„° ì–¸ë½! ë” ê°•í•œ ë°©ì–´í˜• ëª¬ìŠ¤í„° ë“±ì¥!");
        }
      }
    }

    // ìŠ¬ë¼ì´ë“œ ë¡œì§ ìµœì í™”
    function slideRow(row) {
      // null ì œê±°
      let filtered = row.filter(cell => cell !== null);
      
      // í•©ì¹˜ê¸°
      for (let i = 0; i < filtered.length - 1; i++) {
        const current = filtered[i];
        const next = filtered[i + 1];
        
        if (current && next && 
            current.type === next.type && 
            current.level === next.level && 
            !current.merged && !next.merged) {
          
          const newLevel = current.level + 1;
          const points = Math.pow(newLevel, 2) * GAME_CONFIG.SCORE_MULTIPLIER;
          gameState.score += points;
          
          if (newLevel === 3) {
            // ë ˆë²¨ 3 ëª¬ìŠ¤í„° ì†Œí™˜ ë˜ëŠ” ê°•í™”
            const newMonster = {
              type: current.type,
              level: newLevel,
              hp: Math.floor(newLevel * GAME_CONFIG.BASE_HP * MONSTERS[current.type].hpMultiplier),
              maxHp: Math.floor(newLevel * GAME_CONFIG.BASE_HP * MONSTERS[current.type].hpMultiplier),
              attack: Math.floor(newLevel * GAME_CONFIG.BASE_ATTACK * MONSTERS[current.type].attackMultiplier)
            };
            
            if (addOrUpgradeMonster(newMonster)) {
              gameState.monstersSpawned++;
              utils.addBattleLog(`ë ˆë²¨ ${newLevel} ${MONSTERS[current.type].name} ì†Œí™˜! (+${points}ì )`);
            }
            
            filtered[i] = null; // ë ˆë²¨ 3ì€ ë³´ë“œì—ì„œ ì œê±°
          } else {
            filtered[i] = { type: current.type, level: newLevel, merged: true };
          }
          filtered[i + 1] = null;
          i++; // ë‹¤ìŒ íƒ€ì¼ ê±´ë„ˆë›°ê¸°
        }
      }
      
      // null ì œê±° ë° ë¹ˆ ìë¦¬ ì±„ìš°ê¸°
      filtered = filtered.filter(cell => cell !== null);
      while (filtered.length < GAME_CONFIG.SIZE) {
        filtered.push(null);
      }
      
      return filtered;
    }

    // ëª¬ìŠ¤í„° ì¶”ê°€ ë˜ëŠ” ì—…ê·¸ë ˆì´ë“œ í•¨ìˆ˜
    function addOrUpgradeMonster(newMonster) {
      // ê°™ì€ íƒ€ì…ì˜ ê¸°ì¡´ ëª¬ìŠ¤í„° ì°¾ê¸°
      const existingIndex = gameState.battleMonsters.findIndex(monster => monster.type === newMonster.type);
      
      if (existingIndex !== -1) {
        // ê¸°ì¡´ ëª¬ìŠ¤í„°ê°€ ìˆìœ¼ë©´ ë ˆë²¨ì—…
        const existingMonster = gameState.battleMonsters[existingIndex];
        const oldLevel = existingMonster.level;
        existingMonster.level += 1;
        
        // ëª¬ìŠ¤í„° íƒ€ì…ë³„ íŠ¹ì„± ì ìš©
        const monsterData = MONSTERS[existingMonster.type];
        existingMonster.maxHp = Math.floor(existingMonster.level * GAME_CONFIG.BASE_HP * monsterData.hpMultiplier);
        existingMonster.attack = Math.floor(existingMonster.level * GAME_CONFIG.BASE_ATTACK * monsterData.attackMultiplier);
        
        // HP íšŒë³µ (íƒ€ì…ë³„ íšŒë³µëŸ‰ ë‹¤ë¦„)
        const healAmount = Math.floor(GAME_CONFIG.BASE_HP * monsterData.hpMultiplier);
        existingMonster.hp = Math.min(existingMonster.hp + healAmount, existingMonster.maxHp);
        
        utils.addBattleLog(`ğŸ”¥ ${monsterData.name} ë ˆë²¨ì—…! Lv.${oldLevel} â†’ Lv.${existingMonster.level}`);
        utils.addBattleLog(`   ğŸ“Š ê³µê²©ë ¥: ${Math.floor(oldLevel * GAME_CONFIG.BASE_ATTACK * monsterData.attackMultiplier)} â†’ ${existingMonster.attack} (${monsterData.specialty})`);
        return false; // ìƒˆ ëª¬ìŠ¤í„°ë¥¼ ì¶”ê°€í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ false
      } else if (gameState.battleMonsters.length < GAME_CONFIG.MAX_BATTLE_MONSTERS) {
        // ìƒˆ ëª¬ìŠ¤í„° ì¶”ê°€
        gameState.battleMonsters.push(newMonster);
        return true; // ìƒˆ ëª¬ìŠ¤í„°ë¥¼ ì¶”ê°€í–ˆìœ¼ë¯€ë¡œ true
      } else {
        // ìµœëŒ€ ëª¬ìŠ¤í„° ìˆ˜ ì´ˆê³¼ - ê°€ì¥ ì•½í•œ ëª¬ìŠ¤í„°ì™€ êµì²´
        let weakestIndex = 0;
        let weakestPower = gameState.battleMonsters[0].level * gameState.battleMonsters[0].attack + gameState.battleMonsters[0].hp;
        
        for (let i = 1; i < gameState.battleMonsters.length; i++) {
          const monster = gameState.battleMonsters[i];
          const power = monster.level * monster.attack + monster.hp;
          if (power < weakestPower) {
            weakestIndex = i;
            weakestPower = power;
          }
        }
        
        const oldMonster = gameState.battleMonsters[weakestIndex];
        gameState.battleMonsters[weakestIndex] = newMonster;
        utils.addBattleLog(`ğŸ’« ${MONSTERS[oldMonster.type].name} (Lv.${oldMonster.level})ì´(ê°€) ìƒˆë¡œìš´ ${MONSTERS[newMonster.type].name} (Lv.${newMonster.level})ë¡œ êµì²´ë¨!`);
        return true; // êµì²´í–ˆìœ¼ë¯€ë¡œ true
      }
    }

    // ë³´ë“œ íšŒì „ ìµœì í™”
    function rotateBoard(board, clockwise = true) {
      const size = GAME_CONFIG.SIZE;
      const result = Array(size).fill(null).map(() => Array(size).fill(null));
      
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          if (clockwise) {
            result[c][size - 1 - r] = board[r][c] ? { ...board[r][c] } : null;
          } else {
            result[size - 1 - c][r] = board[r][c] ? { ...board[r][c] } : null;
          }
        }
      }
      return result;
    }

    // ì´ë™ ì²˜ë¦¬ ìµœì í™”
    function move(direction) {
      // ì´ì „ ìƒíƒœ ì €ì¥
      gameState.previous = {
        board: utils.deepClone(gameState.board),
        score: gameState.score,
        battleMonsters: utils.deepClone(gameState.battleMonsters),
        enemyMonster: gameState.enemyMonster ? utils.deepClone(gameState.enemyMonster) : null,
        bossMonster: gameState.bossMonster ? utils.deepClone(gameState.bossMonster) : null,
        bossLevel: gameState.bossLevel,
        bossKillCount: gameState.bossKillCount,
        bossTurnCounter: gameState.bossTurnCounter,
        commander: gameState.commander ? utils.deepClone(gameState.commander) : null,
        monstersSpawned: gameState.monstersSpawned
      };

      let newBoard;
      switch (direction) {
        case "left":
          newBoard = gameState.board.map(row => slideRow([...row]));
          break;
        case "right":
          newBoard = gameState.board.map(row => slideRow([...row].reverse()).reverse());
          break;
        case "up":
          newBoard = rotateBoard(gameState.board, false);
          newBoard = newBoard.map(row => slideRow([...row]));
          newBoard = rotateBoard(newBoard, true);
          break;
        case "down":
          newBoard = rotateBoard(gameState.board, true);
          newBoard = newBoard.map(row => slideRow([...row]));
          newBoard = rotateBoard(newBoard, false);
          break;
      }

              // ë³´ë“œê°€ ë³€í–ˆëŠ”ì§€ í™•ì¸
      if (JSON.stringify(newBoard) !== JSON.stringify(gameState.board)) {
        gameState.board = newBoard;
        addRandomTile();
        updateDisplay();
        
        // ë§¤ ì´ë™ë§ˆë‹¤ ë³´ìŠ¤ ê³µê²© (ì¼ë°˜ ì ë³´ë‹¤ ìš°ì„ )
        if (gameState.bossMonster && gameState.bossMonster.hp > 0) {
          setTimeout(() => bossAttackPlayer(), 300);
        }
        // ì¼ë°˜ ì  ì „íˆ¬ (ë³´ìŠ¤ ê³µê²© í›„)
        else if (gameState.battleMonsters.length > 0 && gameState.enemyMonster) {
          setTimeout(() => battleStep(), 500);
        }
        
        // ê²Œì„ ì˜¤ë²„ ì²´í¬
        if (isGameOver()) {
          setTimeout(() => showGameOver(), 700);
        }
      }
    }

    // ë³´ìŠ¤ê°€ í”Œë ˆì´ì–´ë¥¼ ê³µê²©í•˜ëŠ” í•¨ìˆ˜
    function bossAttackPlayer() {
      if (!gameState.bossMonster || gameState.bossMonster.hp <= 0) {
        return false;
      }

      // ë³´ìŠ¤ ë ˆë²¨ì— ë”°ë¥¸ ê³µê²©ë ¥ ì¡°ì • (ì´ˆë°˜ ì•½í•˜ê²Œ)
      let bossAttack;
      if (gameState.bossLevel === 1) {
        bossAttack = 15; // 1ë‹¨ê³„ ë³´ìŠ¤: ê³ ì • 15 ë°ë¯¸ì§€
      } else if (gameState.bossLevel <= 3) {
        bossAttack = 10 + (gameState.bossLevel * 10); // 2-3ë‹¨ê³„: 20-30 ë°ë¯¸ì§€
      } else if (gameState.bossLevel <= 5) {
        bossAttack = 20 + (gameState.bossLevel * 15); // 4-5ë‹¨ê³„: 80-95 ë°ë¯¸ì§€
      } else {
        bossAttack = gameState.bossMonster.level * 8; // 6ë‹¨ê³„ ì´í›„: ê¸°ì¡´ ê³µì‹
      }

      // ì•„êµ° ëª¬ìŠ¤í„°ê°€ ìˆìœ¼ë©´ ì²« ë²ˆì§¸ ëª¬ìŠ¤í„° ê³µê²©
      if (gameState.battleMonsters.length > 0) {
        const player = gameState.battleMonsters[0];
        player.hp -= bossAttack;
        utils.addBattleLog(`ğŸ‘‘ ë³´ìŠ¤ ${gameState.bossMonster.name}ì´(ê°€) ${MONSTERS[player.type].name}ì—ê²Œ ${bossAttack} ë°ë¯¸ì§€!`);
        
        if (player.hp <= 0) {
          utils.addBattleLog(`${MONSTERS[player.type].name} (Lv.${player.level}) ì „ë©¸!`);
          gameState.battleMonsters.shift();
        }
      } 
      // ì•„êµ° ëª¬ìŠ¤í„°ê°€ ì—†ìœ¼ë©´ ëŒ€ì¥ ê³µê²©
      else if (gameState.commander && gameState.commander.hp > 0) {
        gameState.commander.hp -= bossAttack;
        utils.addBattleLog(`ğŸ’¥ ë³´ìŠ¤ê°€ ì•„êµ° ëŒ€ì¥ì„ ê³µê²©! ${bossAttack} ë°ë¯¸ì§€!`);
        
        if (gameState.commander.hp <= 0) {
          gameState.commander.hp = 0;
          utils.addBattleLog(`ğŸ’€ ì•„êµ° ëŒ€ì¥ì´ ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤! ê²Œì„ ì˜¤ë²„!`);
          updateDisplay();
          setTimeout(() => showGameOver(), 1000);
          return false;
        }
      }

      updateDisplay();
      
      // ë³´ìŠ¤ ê³µê²© í›„ ì•„êµ°ì˜ ë°˜ê²© (ì•„êµ°ì´ ìˆì„ ë•Œë§Œ)
      if (gameState.battleMonsters.length > 0) {
        setTimeout(() => playerAttackBoss(), 500);
      }
      
      return true;
    }

    // ì•„êµ°ì´ ë³´ìŠ¤ë¥¼ ê³µê²©í•˜ëŠ” í•¨ìˆ˜
    function playerAttackBoss() {
      if (gameState.battleMonsters.length === 0 || !gameState.bossMonster || gameState.bossMonster.hp <= 0) {
        return false;
      }

      const player = gameState.battleMonsters[0];
      const playerAttack = player.attack || Math.floor(player.level * GAME_CONFIG.BASE_ATTACK * MONSTERS[player.type].attackMultiplier);

      // í”Œë ˆì´ì–´ ê³µê²©
      gameState.bossMonster.hp -= playerAttack;
      utils.addBattleLog(`âš”ï¸ ${MONSTERS[player.type].name} (Lv.${player.level})ì´(ê°€) ë³´ìŠ¤ì—ê²Œ ${playerAttack} ë°ë¯¸ì§€!`);
      
      if (gameState.bossMonster.hp <= 0) {
        const bossBonus = 1000 * gameState.bossLevel;
        gameState.score += bossBonus;
        gameState.bossKillCount++; // ë³´ìŠ¤ ì²˜ì¹˜ íšŸìˆ˜ ì¦ê°€
        utils.addBattleLog(`ğŸ‰ ${gameState.bossLevel}ë‹¨ê³„ ë³´ìŠ¤ ${gameState.bossMonster.name} ì²˜ì¹˜! +${bossBonus}ì `);
        utils.addBattleLog(`ğŸ† ì´ ë³´ìŠ¤ ì²˜ì¹˜ íšŸìˆ˜: ${gameState.bossKillCount}ë§ˆë¦¬`);
        
        // ë‹¤ìŒ ë³´ìŠ¤ ìƒì„±
        gameState.bossLevel++;
        gameState.bossTurnCounter = 0;
        gameState.bossMonster.hp = 0;
        updateDisplay();
        
        setTimeout(() => {
          utils.addBattleLog(`âš¡ ${gameState.bossLevel}ë‹¨ê³„ ë³´ìŠ¤ ì¤€ë¹„ ì¤‘...`);
          createBossMonster();
          updateDisplay();
        }, 1000);
        
        return true;
      }

      updateDisplay();
      return true;
    }

    // ë³´ìŠ¤ ì „íˆ¬ ì‹œìŠ¤í…œ
    function battleBoss() {
      if (gameState.battleMonsters.length === 0 || !gameState.bossMonster || gameState.bossMonster.hp <= 0) {
        return false;
      }

      // ë³´ìŠ¤ í„´ ì¹´ìš´í„° ì¦ê°€
      gameState.bossTurnCounter++;
      
      const player = gameState.battleMonsters[0];
      const playerAttack = player.attack || Math.floor(player.level * GAME_CONFIG.BASE_ATTACK * MONSTERS[player.type].attackMultiplier);
      const bossAttack = gameState.bossMonster.level * 8; // ë³´ìŠ¤ëŠ” ë” ê°•í•¨

      // í”Œë ˆì´ì–´ ê³µê²©
      gameState.bossMonster.hp -= playerAttack;
      utils.addBattleLog(`ğŸ‘‘ ${MONSTERS[player.type].name} (Lv.${player.level})ì´(ê°€) ë³´ìŠ¤ì—ê²Œ ${playerAttack} ë°ë¯¸ì§€!`);
      
      if (gameState.bossMonster.hp <= 0) {
        const bossBonus = 1000 * gameState.bossLevel; // ë³´ìŠ¤ ë‹¨ê³„ì— ë”°ë¥¸ ë³´ë„ˆìŠ¤
        gameState.score += bossBonus;
        utils.addBattleLog(`ğŸ‰ ${gameState.bossLevel}ë‹¨ê³„ ë³´ìŠ¤ ${gameState.bossMonster.name} ì²˜ì¹˜! +${bossBonus}ì `);
        
        // ë‹¤ìŒ ë³´ìŠ¤ ìƒì„±
        gameState.bossLevel++;
        gameState.bossTurnCounter = 0; // í„´ ì¹´ìš´í„° ë¦¬ì…‹
        gameState.bossMonster.hp = 0;
        updateDisplay();
        
        setTimeout(() => {
          utils.addBattleLog(`âš¡ ${gameState.bossLevel}ë‹¨ê³„ ë³´ìŠ¤ ì¤€ë¹„ ì¤‘...`);
          createBossMonster();
          updateDisplay();
        }, 1000);
        
        return true;
      }

      // ë³´ìŠ¤ ê³µê²© (ê´‘ì—­ ê³µê²© ì²´í¬)
      if (gameState.bossTurnCounter % GAME_CONFIG.BOSS_AOE_TURNS === 0) {
        // ê´‘ì—­ ê³µê²© - ëª¨ë“  ì•„êµ°ì—ê²Œ ë°ë¯¸ì§€
        const aoeAttack = Math.floor(bossAttack * 0.7); // ê´‘ì—­ ê³µê²©ì€ 70% ë°ë¯¸ì§€
        utils.addBattleLog(`ğŸ’¥ ë³´ìŠ¤ ${gameState.bossMonster.name}ì´(ê°€) ê´‘ì—­ ê³µê²©! ëª¨ë“  ì•„êµ°ì—ê²Œ ${aoeAttack} ë°ë¯¸ì§€!`);
        
        // ëª¨ë“  ì•„êµ° ëª¬ìŠ¤í„°ì—ê²Œ ë°ë¯¸ì§€
        const deadMonsters = [];
        gameState.battleMonsters.forEach((monster, index) => {
          monster.hp -= aoeAttack;
          if (monster.hp <= 0) {
            deadMonsters.push(index);
          }
        });
        
        // ì „ë©¸í•œ ëª¬ìŠ¤í„°ë“¤ ì œê±° (ë’¤ì—ì„œë¶€í„° ì œê±°í•´ì•¼ ì¸ë±ìŠ¤ê°€ ê¼¬ì´ì§€ ì•ŠìŒ)
        deadMonsters.reverse().forEach(index => {
          const deadMonster = gameState.battleMonsters[index];
          utils.addBattleLog(`ğŸ’€ ${MONSTERS[deadMonster.type].name} (Lv.${deadMonster.level}) ê´‘ì—­ ê³µê²©ìœ¼ë¡œ ì „ë©¸!`);
          gameState.battleMonsters.splice(index, 1);
        });
        
      } else {
        // ì¼ë°˜ ê³µê²© - ì²« ë²ˆì§¸ ì•„êµ°ì—ê²Œë§Œ, ì•„êµ°ì´ ì—†ìœ¼ë©´ ëŒ€ì¥ì—ê²Œ
        if (gameState.battleMonsters.length > 0) {
          const player = gameState.battleMonsters[0];
          player.hp -= bossAttack;
          utils.addBattleLog(`ğŸ‘‘ ë³´ìŠ¤ ${gameState.bossMonster.name}ì´(ê°€) ${MONSTERS[player.type].name}ì—ê²Œ ${bossAttack} ë°ë¯¸ì§€!`);
          
          if (player.hp <= 0) {
            utils.addBattleLog(`${MONSTERS[player.type].name} (Lv.${player.level}) ì „ë©¸!`);
            gameState.battleMonsters.shift();
          }
        } else if (gameState.commander && gameState.commander.hp > 0) {
          // ì•„êµ°ì´ ì—†ìœ¼ë©´ ëŒ€ì¥ ê³µê²©
          gameState.commander.hp -= bossAttack;
          utils.addBattleLog(`ğŸ’¥ ë³´ìŠ¤ê°€ ì•„êµ° ëŒ€ì¥ì„ ê³µê²©! ${bossAttack} ë°ë¯¸ì§€!`);
          
          if (gameState.commander.hp <= 0) {
            gameState.commander.hp = 0;
            utils.addBattleLog(`ğŸ’€ ì•„êµ° ëŒ€ì¥ì´ ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤! ê²Œì„ ì˜¤ë²„!`);
            updateDisplay();
            setTimeout(() => showGameOver(), 1000);
            return false;
          }
        }
      }

      // ë‹¤ìŒ ê´‘ì—­ ê³µê²©ê¹Œì§€ ë‚¨ì€ í„´ í‘œì‹œ
      const turnsUntilAoe = GAME_CONFIG.BOSS_AOE_TURNS - (gameState.bossTurnCounter % GAME_CONFIG.BOSS_AOE_TURNS);
      if (turnsUntilAoe === GAME_CONFIG.BOSS_AOE_TURNS) {
        utils.addBattleLog(`âš ï¸ ë‹¤ìŒ ê´‘ì—­ ê³µê²©ê¹Œì§€ ${GAME_CONFIG.BOSS_AOE_TURNS}í„´!`);
      } else if (turnsUntilAoe <= 2) {
        utils.addBattleLog(`ğŸš¨ ê´‘ì—­ ê³µê²©ê¹Œì§€ ${turnsUntilAoe}í„´ ë‚¨ìŒ!`);
      }

      updateDisplay();
      return true;
    }

    // ì „íˆ¬ ì‹œìŠ¤í…œ ê°œì„ 
    function battleStep() {
      if (gameState.battleMonsters.length === 0) {
        utils.addBattleLog("ëª¨ë“  ëª¬ìŠ¤í„°ê°€ ì „ë©¸í–ˆìŠµë‹ˆë‹¤!");
        return false;
      }

      if (!gameState.enemyMonster) {
        // ì¼ë°˜ ì ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„± (ë³´ìŠ¤ ì „íˆ¬ ì „ê¹Œì§€)
        if (gameState.bossMonster && gameState.bossMonster.hp > 0) {
          createEnemy();
          return true;
        }
        return false;
      }

      const player = gameState.battleMonsters[0];
      const playerAttack = player.attack || Math.floor(player.level * GAME_CONFIG.BASE_ATTACK * MONSTERS[player.type].attackMultiplier);
      const enemyAttack = gameState.enemyMonster.level * GAME_CONFIG.BASE_ATTACK;

      // í”Œë ˆì´ì–´ ê³µê²©
      gameState.enemyMonster.hp -= playerAttack;
      utils.addBattleLog(`${MONSTERS[player.type].name} (Lv.${player.level})ì´(ê°€) ${playerAttack} ë°ë¯¸ì§€!`);
      
      if (gameState.enemyMonster.hp <= 0) {
        const bonus = GAME_CONFIG.DEFEAT_BONUS * gameState.enemyMonster.level;
        gameState.score += bonus;
        utils.addBattleLog(`ì  ${MONSTERS[gameState.enemyMonster.type].name} ì²˜ì¹˜! +${bonus}ì `);
        gameState.enemyMonster = null;
        // ì ì„ ì²˜ì¹˜í–ˆì§€ë§Œ ë°”ë¡œ ìƒˆ ì ì„ ìƒì„±í•˜ì§€ ì•ŠìŒ (ë³´ìŠ¤ ì „íˆ¬ë¡œ ë„˜ì–´ê°€ê¸° ìœ„í•´)
        updateDisplay();
        return true;
      }

      // ì  ê³µê²©
      player.hp -= enemyAttack;
      utils.addBattleLog(`ì ì´ ${MONSTERS[player.type].name}ì—ê²Œ ${enemyAttack} ë°ë¯¸ì§€!`);
      
      if (player.hp <= 0) {
        utils.addBattleLog(`${MONSTERS[player.type].name} (Lv.${player.level}) ì „ë©¸!`);
        gameState.battleMonsters.shift();
      }

      updateDisplay();
      return true;
    }

    // ì  ìƒì„± ê°œì„ 
    function createEnemy() {
      const type = utils.getRandomMonsterType();
      const level = Math.min(3, Math.floor(Math.random() * 3) + 1);
      const hp = level * GAME_CONFIG.BASE_HP;
      
      gameState.enemyMonster = { type, level, hp, maxHp: hp };
      utils.addBattleLog(`ìƒˆë¡œìš´ ì  ${MONSTERS[type].name} (Lv.${level}) ë“±ì¥!`);
    }

    // ì „íˆ¬ í•„ë“œ ì—…ë°ì´íŠ¸ ê°œì„ 
    function updateBattleField() {
      elements.battleField.innerHTML = "";

      // 4ì¹¸ ëª¨ë‘ ì•„êµ° ëª¬ìŠ¤í„°ìš©ìœ¼ë¡œ ì‚¬ìš© (ì êµ° íƒ€ì¼ ì œê±°)
      for (let i = 0; i < 4; i++) {
        const tile = document.createElement("div");
        tile.className = "battle-tile";

        if (i < gameState.battleMonsters.length) {
          // í”Œë ˆì´ì–´ ëª¬ìŠ¤í„° (ìµœëŒ€ 3ë§ˆë¦¬, 4ì¹¸ ì¤‘ ì•ìª½ë¶€í„° ë°°ì¹˜)
          const monster = gameState.battleMonsters[i];
          tile.classList.add("player");
          
          // ëª¬ìŠ¤í„° íƒ€ì…ê³¼ ë ˆë²¨ì— ë§ëŠ” í´ë˜ìŠ¤ ì¶”ê°€
          tile.classList.add(monster.type, `level-${monster.level}`);
          
          const levelDiv = document.createElement("div");
          levelDiv.className = "monster-level";
          levelDiv.textContent = `Lv.${monster.level}`;
          
          const icon = document.createElement("div");
          icon.className = "monster-icon";
          icon.textContent = MONSTERS[monster.type][Math.min(monster.level, 3)]; // ë ˆë²¨ 3ê¹Œì§€ì˜ ì•„ì´ì½˜ ì‚¬ìš©
          
          const statsDiv = document.createElement("div");
          statsDiv.className = "monster-stats";
          
          const hpContainer = document.createElement("div");
          hpContainer.className = "hp-container";
          
          const hpBar = document.createElement("div");
          hpBar.className = "hp-bar";
          
          const hpFill = document.createElement("div");
          hpFill.className = "hp-bar-fill";
          
          // HP ë¹„ìœ¨ì— ë”°ë¥¸ ìƒ‰ìƒ ê³„ì‚°
          const hpPercent = (monster.hp / monster.maxHp) * 100;
          let hpColor;
          
          if (hpPercent > 75) {
            hpColor = 'linear-gradient(90deg, #27ae60, #2ecc71)';
          } else if (hpPercent > 50) {
            hpColor = 'linear-gradient(90deg, #f1c40f, #f39c12)';
          } else if (hpPercent > 25) {
            hpColor = 'linear-gradient(90deg, #e67e22, #d35400)';
          } else {
            hpColor = 'linear-gradient(90deg, #e74c3c, #c0392b)';
          }
          
          hpFill.style.width = `${hpPercent}%`;
          hpFill.style.background = hpColor;
          
          const statsRow = document.createElement("div");
          statsRow.className = "stats-row";
          
          const hpText = document.createElement("div");
          hpText.className = "hp-text";
          hpText.textContent = `ğŸ’š ${monster.hp}/${monster.maxHp}`;
          
          // ê³µê²©ë ¥ í‘œì‹œ
          const attackText = document.createElement("div");
          attackText.className = "attack-text";
          attackText.textContent = `âš”ï¸ ${monster.attack || Math.floor(monster.level * GAME_CONFIG.BASE_ATTACK * MONSTERS[monster.type].attackMultiplier)}`;
          
          hpBar.appendChild(hpFill);
          hpContainer.appendChild(hpBar);
          
          statsRow.appendChild(hpText);
          statsRow.appendChild(attackText);
          
          statsDiv.appendChild(hpContainer);
          statsDiv.appendChild(statsRow);
          
          tile.appendChild(levelDiv);
          tile.appendChild(icon);
          tile.appendChild(statsDiv);
        }
        // ë¹ˆ íƒ€ì¼ì€ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ (ì êµ° íƒ€ì¼ ì½”ë“œ ì œê±°)

        elements.battleField.appendChild(tile);
      }
    }

    // ê²Œì„ ì˜¤ë²„ ì²´í¬
    function isGameOver() {
      // ì•„êµ° ëŒ€ì¥ì´ ì£½ìœ¼ë©´ ì¦‰ì‹œ ê²Œì„ ì˜¤ë²„
      if (gameState.commander && gameState.commander.hp <= 0) {
        return true;
      }
      
      // ë¹ˆ íƒ€ì¼ì´ ìˆìœ¼ë©´ ê³„ì† ê°€ëŠ¥
      if (utils.getEmptyTiles().length > 0) return false;
      
      // í•©ì¹  ìˆ˜ ìˆëŠ” íƒ€ì¼ì´ ìˆëŠ”ì§€ í™•ì¸
      for (let r = 0; r < GAME_CONFIG.SIZE; r++) {
        for (let c = 0; c < GAME_CONFIG.SIZE; c++) {
          const current = gameState.board[r][c];
          if (!current) continue;
          
          // ì˜¤ë¥¸ìª½ íƒ€ì¼ê³¼ ë¹„êµ
          if (c < GAME_CONFIG.SIZE - 1) {
            const right = gameState.board[r][c + 1];
            if (right && current.type === right.type && current.level === right.level) {
              return false;
            }
          }
          
          // ì•„ë˜ìª½ íƒ€ì¼ê³¼ ë¹„êµ
          if (r < GAME_CONFIG.SIZE - 1) {
            const below = gameState.board[r + 1][c];
            if (below && current.type === below.type && current.level === below.level) {
              return false;
            }
          }
        }
      }
      
      return true;
    }

    // ê²Œì„ ì˜¤ë²„ í™”ë©´
    function showGameOver() {
      let gameOverReason = "ë³´ë“œê°€ ê°€ë“ ì°¸!";
      if (gameState.commander && gameState.commander.hp <= 0) {
        gameOverReason = "ì•„êµ° ëŒ€ì¥ ì „ë©¸!";
      }
      
      elements.finalScore.innerHTML = `
        <strong>ìµœì¢… ì ìˆ˜: ${gameState.score.toLocaleString()}ì </strong><br>
        <small>ì†Œí™˜í•œ ëª¬ìŠ¤í„°: ${gameState.monstersSpawned}ë§ˆë¦¬</small><br>
        <small>ì²˜ì¹˜í•œ ë³´ìŠ¤: ${gameState.bossKillCount}ë§ˆë¦¬</small><br>
        <small style="color: #e74c3c;">${gameOverReason}</small>
      `;
      elements.gameOverOverlay.classList.add('show');
    }

    function hideGameOver() {
      elements.gameOverOverlay.classList.remove('show');
    }

    // ê²Œì„ ì¬ì‹œì‘
    function restartGame() {
      gameState.score = 0;
      gameState.bossLevel = 1; // ë³´ìŠ¤ ë ˆë²¨ ì´ˆê¸°í™”
      gameState.bossKillCount = 0; // ë³´ìŠ¤ ì²˜ì¹˜ íšŸìˆ˜ ì´ˆê¸°í™”
      gameState.bossTurnCounter = 0; // ë³´ìŠ¤ í„´ ì¹´ìš´í„° ì´ˆê¸°í™”
      gameState.monstersSpawned = 0;
      initBoard();
      hideGameOver();
    }

    // ë˜ëŒë¦¬ê¸°
    function undoMove() {
      if (gameState.previous.board.length > 0) {
        Object.assign(gameState, utils.deepClone(gameState.previous));
        updateDisplay();
      }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
    document.addEventListener("keydown", (e) => {
      if (["ArrowLeft", "ArrowRight", "ArrowUp", "ArrowDown"].includes(e.key)) {
        e.preventDefault();
        const directions = {
          "ArrowLeft": "left",
          "ArrowRight": "right",
          "ArrowUp": "up",
          "ArrowDown": "down"
        };
        move(directions[e.key]);
      }
    });

    // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ ì§€ì›)
    let touchStart = { x: 0, y: 0 };
    
    document.addEventListener("touchstart", (e) => {
      touchStart.x = e.changedTouches[0].screenX;
      touchStart.y = e.changedTouches[0].screenY;
    }, { passive: true });
    
    document.addEventListener("touchend", (e) => {
      const touchEnd = {
        x: e.changedTouches[0].screenX,
        y: e.changedTouches[0].screenY
      };
      
      const dx = touchEnd.x - touchStart.x;
      const dy = touchEnd.y - touchStart.y;
      const threshold = 30;
      
      if (Math.abs(dx) > Math.abs(dy)) {
        if (Math.abs(dx) > threshold) {
          move(dx > 0 ? "right" : "left");
        }
      } else {
        if (Math.abs(dy) > threshold) {
          move(dy > 0 ? "down" : "up");
        }
      }
    }, { passive: true });

    // ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById("restart").addEventListener("click", restartGame);
    document.getElementById("undo").addEventListener("click", undoMove);

    // ê²Œì„ ì‹œì‘
    initBoard();
  </script>
</body>
</html>
        